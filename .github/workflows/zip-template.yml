name: 'Zip template'
on:
  push:
    paths:
      - 'templates/**'
    branches:
      - main

jobs:
  Templates:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo
        uses: actions/checkout@v3

      - name: Install Zip
        run: sudo apt-get install zip unzip

      - name: Zip commit
        run: |
          changed_files=$(git diff --name-only HEAD~1 HEAD | grep '^templates/')
          if [ -z "$changed_files" ]; then
          else
            templates_arr=()
            echo "$changed_files" | sed 's/\/[^\/]*$//' | grep '^templates/' | sort -u > temp.txt
            mapfile -t templates_arr < temp.txt

            for template in "${templates_arr[@]}"; do
            name="${template##/ }.zip"

            echo "$name"
            zip -r $name $template &
          fi
